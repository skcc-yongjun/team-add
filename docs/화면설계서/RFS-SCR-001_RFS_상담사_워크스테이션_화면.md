# RFS 상담사 워크스테이션 화면 (RFS-SCR-001)

## 사용 역할자: 상담사 (충원 담당자)

---

## 기능 1: 충원 대상자 목록 조회

-   **관련 요구사항:** RFS-REQ-001 (지원자/충원 결과 데이터 연동 결과 조회), RFS-REQ-010 (충원대상자 명부 배수 출력 기반 조회)
-   **입력 정보:**
    -   조회 조건 선택: 모집 시기, 전형, 충원 차수, 모집 단위 (담당자별 접근 제한 고려 - RFS-REQ-013).
    -   상태 필터: 미처리, 통화중, 등록, 포기, 부재 등.
    -   '조회' 버튼 클릭.
-   **출력 정보:**
    -   충원 대상자 목록 테이블 (우선순위(예비순위), 수험번호, 이름, 연락처, 모집 단위, 현재 상태, 통화 시도 횟수, 마지막 통화 결과, 메모 아이콘, 통화 버튼).
    -   현재 차수 충원 현황 요약 (총 대상, 등록, 포기, 잔여 인원).
-   **프로세스 설명:**
    1.  상담사가 담당하는 충원 차수, 모집 단위 등의 조건을 확인/선택하고 조회한다.
    2.  클라이언트는 조건을 API로 전송하여 해당 조건의 충원 대상자 목록 및 상태를 조회한다. (AMS에서 전송된 `ADMISSION_DECISION`, `RECRUITMENT_LOG` 데이터 기반)
    3.  서버는 우선순위(예비 순위 등)에 따라 정렬된 목록을 반환한다.
    4.  클라이언트는 목록과 요약 정보를 화면에 표시한다.
-   **호출 API 정보:**
    -   HTTP 메서드: GET
    -   API 엔드포인트: `/api/rfs/recruitment/targets`
    -   API 목적: 충원 대상자 목록 조회
    -   요청 파라미터: `admissionRound`, `recruitmentRound`, `departmentCode`, `status`, etc.
    -   응답 파라미터:
        ```json
        {
          "summary": {"totalTargets": 20, "registered": 5, "declined": 3, "pending": 12},
          "targets": [
            {
              "applicationId": 1025, "applicantId": "2024S0025", "name": "김예비",
              "phoneNumber": "010-1111-2222", "departmentName": "경영학과",
              "preliminaryRank": 1, "status": "미처리", "callAttempts": 0,
              "lastCallResult": null
            },
            {
              "applicationId": 1030, "applicantId": "2024S0030", "name": "박충원",
              "phoneNumber": "010-3333-4444", "departmentName": "경영학과",
              "preliminaryRank": 2, "status": "등록", "callAttempts": 1,
              "lastCallResult": "등록"
            }, ...
          ]
        }
        ```
-   **Mockup 데이터 예시:**
    -   입력: 1차 충원, 경영학과 조회.
    -   출력: 해당 조건의 예비 1번부터 순서대로 목록 표시 및 요약 정보.

## 기능 2: 클릭 투 콜 (Click-to-Call) 및 자동 녹취

-   **관련 요구사항:** RFS-REQ-002: 클릭 전화·녹음·데이터 저장·전송 (전화 걸기 및 녹취 시작)
-   **입력 정보:** 목록에서 특정 대상자의 '통화' 버튼 클릭.
-   **출력 정보:**
    -   CTI 솔루션 연동: 상담사 전화기에서 자동으로 전화 발신 시작.
    -   화면에 통화 상태 표시 (연결중, 통화중).
    -   (백그라운드) 통화 내용 녹취 시작.
    -   통화 대상자 정보 하이라이트 또는 별도 통화 정보 창 표시 (이름, 수험번호, 이전 통화 내역 요약 등).
-   **프로세스 설명:**
    1.  상담사가 '통화' 버튼을 클릭한다.
    2.  클라이언트는 해당 대상자의 전화번호와 상담사 정보를 포함하여 CTI 연동 API를 호출한다.
    3.  서버(또는 클라이언트 측 CTI 미들웨어)는 CTI 솔루션에 전화 발신 명령을 전달한다. 동시에 녹취 시작 명령도 전달될 수 있다.
    4.  CTI 시스템은 상담사 전화기를 통해 실제 발신을 수행하고, 통화 상태 이벤트를 RFS 시스템에 전달한다.
    5.  RFS 클라이언트는 수신된 이벤트에 따라 화면의 통화 상태를 업데이트한다.
-   **호출 API 정보:**
    -   HTTP 메서드: POST
    -   API 엔드포인트: `/api/rfs/calls/start`
    -   API 목적: CTI 연동 전화 발신 및 녹취 시작 요청
    -   요청 파라미터 (Body):
        ```json
        {
          "applicationId": 1025,
          "phoneNumber": "010-1111-2222",
          "counselorId": "현재 로그인 상담사 ID"
        }
        ```
    -   응답 파라미터: CTI 연동 요청 결과 (성공/실패)
        ```json
        { "success": true, "message": "Calling initiated.", "callId": "CTI 시스템의 통화 ID" }
        ```
-   **Mockup 데이터 예시:**
    -   입력: 김예비 학생 '통화' 버튼 클릭.
    -   출력: 상담사 전화기에서 발신 시작, 화면에 "김예비님 연결중..." 표시.

## 기능 3: 통화 결과 및 메모 입력, 녹취 데이터 저장

-   **관련 요구사항:** RFS-REQ-002 (데이터 저장/전송), RFS-REQ-004 (녹취 데이터/통화내역/메모 관리)
-   **입력 정보:**
    -   통화 종료 후:
        -   통화 결과 선택 드롭다운 (등록, 포기, 부재, 통화중 등).
        -   상담 메모 입력 텍스트 영역.
    -   '저장' 버튼 클릭.
-   **출력 정보:**
    -   저장 성공/실패 메시지.
    -   목록 테이블에서 해당 대상자의 상태, 마지막 통화 결과, 통화 시도 횟수 업데이트.
    -   메모 아이콘 활성화 또는 변경.
-   **프로세스 설명:**
    1.  통화가 종료되면(CTI 이벤트 수신 또는 수동 종료), 상담사는 통화 결과와 메모를 입력한다.
    2.  '저장' 버튼을 클릭하면, 클라이언트는 입력된 정보(결과, 메모)와 해당 통화 정보(callId 등)를 로그 저장 API로 전송한다.
    3.  서버는 `RECRUITMENT_LOG` 테이블에 통화 시작/종료 시간, 통화 결과, 메모, 상담사 ID, 녹취 파일 경로(CTI 시스템에서 전달받음) 등을 기록한다.
    4.  또한, `ADMISSION_DECISION` 테이블의 충원 상태(`recruiter_status`)를 통화 결과에 따라 업데이트한다 (예: '등록' 또는 '포기' 확정 시).
    5.  처리 결과를 클라이언트에 반환하고, 클라이언트는 화면을 갱신한다.
    6.  (동시에) RFS 서버는 확정된 충원 결과(등록/포기)를 AMS 시스템으로 전송하는 API를 호출한다 (RFS-REQ-001).
-   **호출 API 정보:**
    -   로그 저장 API:
        -   HTTP 메서드: POST
        -   API 엔드포인트: `/api/rfs/calls/log`
        -   API 목적: 통화 결과 및 메모, 녹취 정보 저장
        -   요청 파라미터 (Body):
            ```json
            {
              "callId": "CTI 통화 ID", // CTI 연동 시 받은 ID
              "applicationId": 1025,
              "callResult": "등록", // 포기, 부재 등
              "memo": "보호자와 통화 후 등록 의사 확인함.",
              "callStartTime": "통화 시작 시간", // CTI 이벤트에서 받거나 추정
              "callEndTime": "통화 종료 시간",
              "recordingFilePath": "/path/to/recording_file.mp3" // CTI에서 전달받음
            }
            ```
        -   응답 파라미터: 저장 성공/실패 정보
    -   AMS 결과 전송 API (서버 내부 호출):
        -   (예시) `POST /api/ams/recruitment/update-status`
        -   Body: `{ "applicationId": 1025, "status": "REGISTERED" }`
-   **Mockup 데이터 예시:**
    -   입력: 통화 후 '등록' 선택, 메모 입력 후 '저장' 클릭.
    -   출력: "통화 결과 저장 완료." 메시지. 목록에서 김예비 학생 상태 '등록', 마지막 통화 결과 '등록', 시도 횟수 업데이트.

## 기능 4: SMS 발송

-   **관련 요구사항:** RFS-REQ-003: SMS 발송
-   **입력 정보:**
    -   목록에서 대상자 선택 (단일/다중).
    -   'SMS 발송' 버튼 클릭.
    -   SMS 발송 팝업:
        -   템플릿 선택 드롭다운 (미리 정의된 문구: 예비 합격 안내, 부재중 안내 등).
        -   메시지 내용 확인 및 수정 (텍스트 영역).
        -   발송 예약 시간 설정 (선택 사항).
    -   '발송' 버튼 클릭.
-   **출력 정보:**
    -   SMS 발송 요청 결과 메시지 (성공/실패).
    -   발송 이력 확인 기능 (별도 화면 또는 탭).
-   **프로세스 설명:**
    1.  상담사가 SMS를 발송할 대상자를 선택하고 'SMS 발송' 버튼을 클릭한다.
    2.  SMS 발송 팝업에서 템플릿을 선택하거나 내용을 직접 작성하고 '발송' 버튼을 클릭한다.
    3.  클라이언트는 수신자 번호 목록, 메시지 내용, 예약 시간 등을 API로 전송한다.
    4.  서버는 외부 SMS 발송 서비스와 연동하여 발송을 요청한다.
    5.  발송 요청 결과 및 최종 발송 상태(성공/실패)를 `SMS_LOG` 테이블에 기록한다.
    6.  요청 결과를 클라이언트에 즉시 반환하고, 클라이언트는 메시지를 표시한다.
-   **호출 API 정보:**
    -   HTTP 메서드: POST
    -   API 엔드포인트: `/api/rfs/sms/send`
    -   API 목적: 선택된 대상자에게 SMS 발송 요청
    -   요청 파라미터 (Body):
        ```json
        {
          "recipients": [
            {"applicationId": 1025, "phoneNumber": "010-1111-2222"}, ...
          ],
          "message": "X대학교 1차 충원 합격 안내입니다. 등록 절차는...",
          "sendAt": "예약 발송 시간 (ISO 8601 형식, optional)"
        }
        ```
    -   응답 파라미터: 발송 요청 접수 결과 (성공/실패)
-   **Mockup 데이터 예시:**
    -   입력: 부재중이었던 학생 선택 -> '부재중 안내' 템플릿 선택 -> '발송' 클릭.
    -   출력: "SMS 발송 요청 완료." 메시지.

## 기능 5: 중복 지원자 정보 조회

-   **관련 요구사항:** RFS-REQ-005: 중복지원자 정보 제공
-   **입력 정보:** 통화 대상자 정보 창 또는 목록에서 '중복 지원 정보' 아이콘/버튼 클릭.
-   **출력 정보:**
    -   팝업 또는 별도 섹션에 해당 지원자의 다른 전형/모집 단위 지원 현황 및 상태 표시 (예: "타 학과(OO학과) 예비 X번", "타 전형(XX전형) 이미 등록 완료").
-   **프로세스 설명:**
    1.  상담사가 특정 지원자의 중복 지원 정보를 확인하기 위해 버튼을 클릭한다.
    2.  클라이언트는 해당 지원자의 고유 ID(주민번호 기반 식별자 등)를 사용하여 중복 지원 정보 조회 API를 호출한다.
    3.  서버는 `APPLICANT` 테이블과 `APPLICATION`, `ADMISSION_DECISION` 테이블을 조합하여 해당 지원자의 모든 지원 내역 및 현재 상태(합격, 등록 등)를 조회하여 반환한다.
    4.  클라이언트는 수신된 정보를 팝업 등에 표시한다.
-   **호출 API 정보:**
    -   HTTP 메서드: GET
    -   API 엔드포인트: `/api/rfs/applicants/{applicantUniqueId}/duplicates`
    -   API 목적: 특정 지원자의 중복 지원 내역 조회
    -   요청 파라미터 (Path Variable): `applicantUniqueId` (주민번호 앞자리+이름 등 고유 식별 가능 정보)
    -   응답 파라미터:
        ```json
        [
          {
            "applicationId": 1025, "admissionRound": "2024 수시", "admissionType": "학생부종합",
            "departmentName": "경영학과", "decisionResult": "예비", "preliminaryRank": 1,
            "recruiterStatus": "미처리" // 현재 RFS 대상 건
          },
          {
            "applicationId": 1088, "admissionRound": "2024 수시", "admissionType": "학생부교과",
            "departmentName": "국어국문학과", "decisionResult": "최초합", "preliminaryRank": null,
            "recruiterStatus": "등록" // 이미 다른 곳에 등록함
          }
        ]
        ```
-   **Mockup 데이터 예시:**
    -   입력: 김예비 학생 '중복 지원 정보' 클릭.
    -   출력: 팝업에 위 응답 파라미터 내용 표시. (상담사가 이미 다른 곳에 등록했음을 인지)

---

