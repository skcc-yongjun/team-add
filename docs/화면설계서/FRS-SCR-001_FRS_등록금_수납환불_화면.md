# FRS 등록금 수납/환불 화면 (FRS-SCR-001)

## 사용 역할자: 재무 담당자, 시스템 관리자 (FRS)

(수험생용 납부/환불 신청 화면은 별도로 필요하나, 여기서는 관리자 화면 위주로 설계)

---

## 기능 1: 실시간 입금 내역 조회 및 확인

-   **관련 요구사항:** FRS-REQ-001: 실시간 입금 확인·SMS 통보·DB 연동 (결과 조회)
-   **입력 정보:**
    -   조회 기간 선택 (시작일, 종료일).
    -   조회 조건 필터링 (납부 상태 - 확인/미확인, 모집 시기, 학과 등).
    -   검색 키워드 입력 (수험번호, 이름, 가상계좌번호).
    -   '조회' 버튼 클릭.
-   **출력 정보:**
    -   실시간 입금 내역 테이블 (입금 일시, 입금자명, 입금 금액, 가상계좌번호, 수험번호, 이름, 처리 상태 - 확인/미확인/오류, 확인자, 확인 일시).
    -   입금 현황 요약 (총 입금 건수, 총 입금액, 미확인 건수).
    -   오류 내역 알림 (예: 입금액 불일치, 미등록 가상계좌 입금).
-   **프로세스 설명:**
    1.  금융기관으로부터 펌뱅킹 등을 통해 실시간 입금 통지 데이터가 FRS DB(`PAYMENT` 또는 별도 입금로그 테이블)에 누적된다.
    2.  재무 담당자가 화면에서 조회 조건을 설정하고 조회한다.
    3.  클라이언트는 조건을 API로 전송하여 입금 내역을 조회한다.
    4.  서버는 DB에서 해당 기간/조건의 입금 내역을 조회하여 반환한다. 입금 내역은 AMS의 등록 대상자 정보와 매칭하여 수험번호, 이름 등을 함께 표시한다.
    5.  클라이언트는 목록과 요약 정보를 화면에 표시한다.
-   **호출 API 정보:**
    -   HTTP 메서드: GET
    -   API 엔드포인트: `/api/frs/payments/realtime-log`
    -   API 목적: 실시간 입금 내역 조회
    -   요청 파라미터: `startDate`, `endDate`, `status`, `keyword`, etc.
    -   응답 파라미터:
        ```json
        {
          "summary": {"totalCount": 50, "totalAmount": 225000000, "unconfirmedCount": 5},
          "logs": [
            {
              "transactionId": "BANK_TRX_123", "depositDateTime": "2024-08-16T10:00:05",
              "depositorName": "홍길동", "amount": 4500000, "virtualAccount": "123-456-789012",
              "applicantId": "2024S0001", "name": "홍길동", "status": "확인",
              "confirmedBy": "재무담당", "confirmedAt": "2024-08-16T10:05:00"
            },
            {
              "transactionId": "BANK_TRX_124", "depositDateTime": "2024-08-16T10:02:10",
              "depositorName": "김수험", "amount": 4000000, // 금액 불일치
              "virtualAccount": "123-456-789013",
              "applicantId": "2024S0002", "name": "김수험", "status": "오류(금액불일치)",
              "confirmedBy": null, "confirmedAt": null
            }, ...
          ]
        }
        ```
-   **Mockup 데이터 예시:**
    -   입력: 오늘 날짜 조회.
    -   출력: 오늘 발생한 입금 내역 목록 및 요약 정보 표시. 오류 건 하이라이트.

## 기능 2: 입금 내역 수동 확인 및 처리

-   **관련 요구사항:** FRS-REQ-001 (DB 연동 확인)
-   **입력 정보:**
    -   목록에서 '미확인' 또는 '오류' 상태의 입금 건 선택.
    -   '수동 확인' 버튼 클릭 또는 상태 변경 드롭다운 사용.
    -   (오류 처리 시) 처리 방법 선택 또는 메모 입력.
-   **출력 정보:** 해당 입금 건의 처리 상태 변경. 성공/실패 메시지.
-   **프로세스 설명:**
    1.  시스템 자동 매칭(가상계좌번호, 금액 일치) 외에 수동 확인이 필요한 건에 대해 담당자가 처리한다.
    2.  '수동 확인' 클릭 시, 클라이언트는 해당 입금 건 ID와 처리 상태('확인')를 API로 전송한다.
    3.  서버는 해당 입금 로그의 상태를 업데이트하고, `PAYMENT` 테이블의 납부 상태를 '완료'로 변경하며, 납부 일시 등을 기록한다.
    4.  (중요) 서버는 이 납부 완료 정보를 AMS 시스템으로 실시간 전송(API 호출)하여 AMS의 등록 상태도 업데이트한다 (FRS-REQ-001).
    5.  (부가) 서버는 설정에 따라 납부 완료 SMS를 수험생에게 발송하도록 요청한다 (FRS-REQ-001).
    6.  처리 결과를 FRS 클라이언트에 반환하여 화면을 갱신한다.
-   **호출 API 정보:**
    -   수동 확인 처리 API:
        -   HTTP 메서드: PUT 또는 PATCH
        -   API 엔드포인트: `/api/frs/payments/confirm/{transactionId}`
        -   API 목적: 입금 내역 수동 확인 처리
        -   요청 파라미터 (Path Variable): `transactionId` (은행 거래 ID 또는 내부 로그 ID)
        -   요청 파라미터 (Body): `{ "status": "CONFIRMED", "confirmedBy": "로그인 담당자 ID" }`
        -   응답 파라미터: 성공/실패 정보
    -   AMS 상태 업데이트 API (서버 내부 호출):
        -   (예시) `POST /api/ams/registration/update-payment-status`
        -   Body: `{ "applicationId": ..., "paymentStatus": "완료", "paidAt": ... }`
    -   SMS 발송 요청 API (서버 내부 호출):
        -   (예시) `POST /api/sms/send` (공통 SMS 모듈 사용 가능)
-   **Mockup 데이터 예시:**
    -   입력: 미확인 건 선택 후 '수동 확인' 클릭.
    -   출력: 해당 건 상태 '확인'으로 변경. "처리 완료" 메시지. (백그라운드에서 AMS 업데이트 및 SMS 발송 요청)

## 기능 3: 환불 신청 내역 조회 및 승인

-   **관련 요구사항:** FRS-REQ-003: 실시간 환불 신청·SMS·DB 연동 (결과 조회 및 승인)
-   **입력 정보:**
    -   조회 조건 필터링 (신청 기간, 처리 상태 - 신청/승인/반려/완료).
    -   '조회' 버튼 클릭.
    -   목록에서 '신청' 상태의 환불 건 선택.
    -   '승인' 또는 '반려' 버튼 클릭.
    -   (반려 시) 사유 입력.
-   **출력 정보:**
    -   환불 신청 내역 테이블 (신청 일시, 수험번호, 이름, 학과, 환불 금액, 환불 계좌, 신청 사유, 처리 상태, 처리자, 처리 일시).
    -   처리 결과 메시지 (승인/반려 완료).
    -   목록의 해당 건 상태 업데이트.
-   **프로세스 설명:**
    1.  수험생이 별도 화면(수험생 포털 등)에서 환불을 신청하면, `REFUND` 테이블에 데이터가 생성된다.
    2.  재무 담당자가 환불 관리 화면에서 '신청' 상태의 건들을 조회한다.
    3.  내역 확인 후 '승인' 또는 '반려' 버튼을 클릭한다.
    4.  클라이언트는 해당 환불 ID(`refundId`)와 처리 결과(승인/반려, 반려 사유)를 API로 전송한다.
    5.  서버는 `REFUND` 테이블의 상태를 업데이트하고, 처리자 및 처리 일시를 기록한다.
    6.  (승인 시 중요) 서버는 이 환불 승인 정보를 RFS 시스템으로 전송(API 호출)하여 충원 프로세스를 시작하도록 신호를 보낸다 (FRS-REQ-004).
    7.  (부가) 서버는 설정에 따라 환불 처리 결과 SMS를 수험생에게 발송하도록 요청한다 (FRS-REQ-003).
    8.  처리 결과를 FRS 클라이언트에 반환하여 화면을 갱신한다.
-   **호출 API 정보:**
    -   환불 내역 조회 API:
        -   HTTP 메서드: GET
        -   API 엔드포인트: `/api/frs/refunds`
        -   요청 파라미터: 조회 조건 (`status`, `startDate`, `endDate`)
        -   응답 파라미터: 환불 신청 목록
    -   환불 승인/반려 API:
        -   HTTP 메서드: PUT 또는 PATCH
        -   API 엔드포인트: `/api/frs/refunds/{refundId}/process`
        -   API 목적: 환불 신청 건 승인 또는 반려 처리
        -   요청 파라미터 (Path Variable): `refundId`
        -   요청 파라미터 (Body):
            ```json
            {
              "status": "APPROVED", // 또는 REJECTED
              "processedBy": "로그인 담당자 ID",
              "rejectReason": "환불 불가 사유..." // 반려 시
            }
            ```
        -   응답 파라미터: 성공/실패 정보
    -   RFS 충원 시작 신호 API (서버 내부 호출):
        -   (예시) `POST /api/rfs/recruitment/start-signal`
        -   Body: `{ "applicationId": ..., "departmentCode": ... }` // 환불로 인해 충원 필요 발생 정보
    -   SMS 발송 요청 API (서버 내부 호출)
-   **Mockup 데이터 예시:**
    -   입력: '신청' 상태 환불 건 선택 후 '승인' 클릭.
    -   출력: 해당 건 상태 '승인'으로 변경. "환불 승인 완료" 메시지. (백그라운드에서 RFS 신호 전송 및 SMS 발송 요청)

## 기능 4: 가상 계좌 관리 (발급 현황 조회)

-   **관련 요구사항:** FRS-REQ-002: 가상계좌 개설·동의·실시간 입금 (발급 결과 조회)
-   **입력 정보:** 조회 조건 (모집 시기, 발급 상태 등). '조회' 버튼 클릭.
-   **출력 정보:** 가상 계좌 발급 현황 목록 테이블 (수험번호, 이름, 가상계좌번호, 발급은행, 발급일시, 만료일, 상태).
-   **프로세스 설명:** AMS에서 등록 대상자 데이터 준비(AMS-SCR-006 기능 2) 후, FRS 시스템은 금융 기관과 연계하여 대상자별 가상 계좌를 발급받는다. 이 화면에서는 발급된 가상 계좌 현황을 조회한다.
-   **호출 API 정보:**
    -   HTTP 메서드: GET
    -   API 엔드포인트: `/api/frs/virtual-accounts`
    -   API 목적: 발급된 가상 계좌 목록 및 상태 조회
    -   요청 파라미터: 조회 조건
    -   응답 파라미터: 가상 계좌 목록
-   **Mockup 데이터 예시:**
    -   입력: 2024 수시 조회.
    -   출력: 해당 모집 시기 합격자들에게 발급된 가상 계좌 목록 표시.

---
---

